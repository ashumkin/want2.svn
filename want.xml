<!-- $Id$ -->
<!-- This is the Dante script for building Dante -->
<project name="dante"
         basedir=".."
         default="dist" >
  
  <property name="version" value="0.0.1-beta" />

  <echo message="${basedir}" />
  <echo message="The base directory is ${basedir}." />

  <property name="src"  value="${basedir}/src" />
  <property name="dist" value="${basedir}/dist" />
  <property name="res"  value="${basedir}/res" />
  <property name="lib"  value="${basedir}/lib" />

  <property name="bin" value="${basedir}/bin" />
  <property name="dcu" value="${basedir}/dcu" />

  <property name="jcl"     value="${src}/jcl" />
  <property name="paszlib" value="${lib}/paszlib" />

  <echo message="The source directory is ${src}." />
  <echo message="The default command processor is %{comspec}." />

  <target name="prepare" >
    <mkdir dir="${dcu}" />
    <mkdir dir="${bin}" />
  </target>

  <target name="clean" >
    <delete dir="${dist}" />
    <delete dir="${dcu}" />
    <delete dir="${bin}" />
  </target>

  <target name="compile" depends="prepare" >
    <log file="compile.log" >
      <info>
        Compile started.
      </info>
    </log>
    <!-- Delete dante.cfg first to get a reproducible build.
         (Should this be automated?)
    -->
    <touch  file="${src}/dante.cfg"  />
    <delete file="${src}/dante.cfg" />
    <dcc source="${src}/dante.dpr"
         exes="${basedir}"
         dcus="${dcu}"
         quiet="true"
         build="true"
         optimize="true"
			debug="false"
    >
      <unit path="${jcl}" />
      <unit path="${src}" />
      <unit path="${src}/tasks" />
      <unit path="${src}/xml" />
      <unit path="${src}/paths" />
      <unit path="${src}/zip" />

      <unit path="${paszlib}" />
      <unit path="${paszlib}/minizip" />
		
      <include path="${jcl}" />
      
      <resource path="${src}" />
      <resource path="${res}" />
    </dcc>
    <log file="compile.log" >
      <info>
        Compile suceeded.
      </info>
    </log>
  </target>

  <target name="dist" depends="prepare,compile" >
    <mkdir dir="${dist}" />
    <property name="zipfile" value="${dist}/dante-${version}.zip" />
	 <delete file="${zipfile}" />
	 <zip zipfile="${zipfile}" >
         <exclude name="${dist}/**" />
	      
	      <include name="${basedir}/dante.exe" />
			
	      <include name="**/*.pas" />
	      <include name="**/*.dpr" />
	      <include name="**/*.inc" />
	      <include name="**/*.rc" />
	      <include name="**/*.res" />
	      <include name="**/*.html" />
	      <include name="**/*.gif" />
	      <include name="**/*.png" />
	      <include name="**/*.jpg" />
	      <include name="**/*.jpeg" />
	      
			<include name="${lib}/paszlib*.zip" />
			<exclude name="${lib}/paszlib/**"   />
			<include name="${lib}/jcl*.zip" />
			<exclude name="${lib}/jcl/**"   />
			<exclude name="${src}/jcl/**"   />
	 </zip>
  </target>

</project>
