<!-- $Id$ -->
<!-- This is the Dante script for building Dante -->
<project name="dante"
         basedir=".."
         default="dist" >

  <echo message="${basedir}" />
  <echo message="The base directory is ${basedir}." />

  <property name="src"  value="${basedir}/src" />
  <property name="dist" value="${basedir}/dist" />
  <property name="res"  value="${basedir}/res" />

  <property name="bin" value="${basedir}/bin" />
  <property name="dcu" value="${basedir}/dcu" />

  <property name="jcl" value="${src}/jcl" />

  <echo message="The source directory is ${src}." />
  <echo message="The default command processor is %{comspec}." />

  <target name="prepare" >
    <mkdir dir="${dist}" />
    <log file="test.log" >
      <info code="66">
        Logger task test
      </info>
    </log>
  </target>

  <target name="clean" >
    <delete dir="${dist}" />
    <!--
    <delete dir="${dcu}" />
    <delete dir="${bin}" />
    -->
  </target>

  <target name="compile" depends="prepare" >
    <!-- Delete dante.cfg first to get a reproducible build.
         (Should this be automated?)
    -->
    <touch  file="${src}/dante.cfg"  />
    <delete file="${src}/dante.cfg" />
    <dcc source="${src}/dante.dpr"
         exes="${basedir}"
         dcus="${dcu}"
         quiet="true"
         build="true"
         optimize="true"
    >
      <unit path="${jcl}" />
      <unit path="${src}" />
      <unit path="${src}/tasks" />
      <unit path="${src}/xml" />
      <unit path="${src}/paths" />

      <include path="${jcl}" />
      
      <resource path="${src}" />
      <resource path="${res}" />
    </dcc>
  </target>

  <target name="dist" depends="prepare,compile" >
    <mkdir dir="${dist}" />
    <copy todir="${dist}" >
      <include name="**/*.html" />
      <include name="**/*.exe"  />
      <exclude name="**/*Test*" />
   </copy>
    <exec executable=".\make\zip.exe" arguments="-m .\make\dante.zip .\dist\dante.exe" />
  </target>
  
</project>
